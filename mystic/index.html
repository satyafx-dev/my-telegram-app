<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator Hermeneutika</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #111827; }
        .card { background-color: #1F2937; border: 1px solid #374151; }
        .input-field, .textarea-field { background-color: #374151; border: 1px solid #4B5563; color: #F9FAFB; }
        .textarea-field::placeholder { color: #9CA3AF; }
        .result-item { background-color: #374151; border-bottom: 1px solid #4B5563; }
        .result-item:last-child { border-bottom: none; }
        .accordion-button { background-color: #374151; transition: background-color 0.2s; }
        .accordion-button:hover { background-color: #4B5563; }
        .accordion-content { max-height: 0; overflow: hidden; transition: max-height 0.3s ease-out; }
        .tooltip { position: relative; display: inline-block; cursor: help; }
        .tooltip .tooltiptext { visibility: hidden; width: 240px; background-color: #111827; color: #fff; text-align: left; border-radius: 6px; padding: 8px; position: absolute; z-index: 10; bottom: 125%; left: 50%; margin-left: -120px; opacity: 0; transition: opacity 0.3s; font-size: 0.8rem; line-height: 1.5; }
        .tooltip:hover .tooltiptext { visibility: visible; opacity: 1; }
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid #ca8a04; border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="text-gray-200 p-4 sm:p-6 md:p-8">

    <div class="max-w-3xl mx-auto">
        <header class="text-center mb-6">
            <h1 class="text-3xl sm:text-4xl font-bold text-amber-400">Kalkulator Hermeneutika</h1>
            <p class="text-gray-400 mt-2">Alat bantu untuk studi Gematria, Isopsephy, dan lainnya.</p>
        </header>

        <main class="card rounded-xl shadow-lg p-4 sm:p-6">
            <div class="flex items-center gap-2">
                <input type="text" id="mainInput" class="input-field w-full px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-400 text-lg" placeholder="Ketik (elohim, yeshua, aletheia)..." dir="auto">
                <div class="tooltip">
                    <svg class="w-6 h-6 text-gray-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg>
                    <span class="tooltiptext"><b>Panduan Penulisan:</b><br>Ketik istilah Ibrani atau Yunani dalam huruf Latin. Aplikasi akan menggunakan kamus internal untuk akurasi.<br>Contoh: <b>elohim, yahweh, aletheia</b></span>
                </div>
                <button id="clearButton" class="bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-lg transition-colors">Bersihkan</button>
            </div>
            <div id="feedbackContainer" class="text-sm text-gray-500 mt-2 h-10 flex flex-col items-start">
                <div class="flex items-center"><span id="detectedLang"></span><span id="transliteratedText" class="ml-2 text-amber-300 font-mono" dir="rtl"></span></div>
                <div class="flex items-center"><span id="transliteratedGreekText" class="ml-2 text-sky-300 font-mono"></span></div>
            </div>

            <div id="results" class="mt-6 space-y-3">
                <!-- Gematria Section -->
                <div class="accordion-item">
                    <button class="accordion-button w-full text-left p-4 rounded-lg flex justify-between items-center"><span class="font-semibold text-lg text-amber-500">Gematria (Ibrani)</span><svg class="w-5 h-5 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></button>
                    <div class="accordion-content bg-gray-900/50 rounded-b-lg"><div class="p-4 space-y-4">
                        <div><label for="gematriaMethod" class="block text-sm font-medium text-gray-400 mb-2">Pilih Metode:</label><select id="gematriaMethod" class="input-field w-full px-3 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-400"><option value="hechrechi">Mispar Hechrechi</option><option value="siduri">Mispar Siduri</option><option value="katan">Mispar Katan</option><option value="katanMispari">Mispar Katan Mispari</option><option value="gadol">Mispar Gadol</option><option value="milui">Milui (Isian)</option></select></div>
                        <div id="gematriaSingleResult" class="min-h-[70px]"></div>
                        <textarea id="gematriaAnalysisResult" class="textarea-field w-full h-40 p-3 rounded-lg hidden" readonly placeholder="Hasil analisis AI akan muncul di sini..."></textarea>
                    </div></div>
                </div>
                <!-- Isopsephy Section -->
                <div class="accordion-item">
                     <button class="accordion-button w-full text-left p-4 rounded-lg flex justify-between items-center"><span class="font-semibold text-lg text-sky-400">Isopsephy (Yunani)</span><svg class="w-5 h-5 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></button>
                    <div class="accordion-content bg-gray-900/50 rounded-b-lg"><div class="p-4 space-y-4">
                        <div id="isopsephySingleResult" class="min-h-[70px]"></div>
                        <textarea id="isopsephyAnalysisResult" class="textarea-field w-full h-40 p-3 rounded-lg hidden" readonly placeholder="Hasil analisis AI akan muncul di sini..."></textarea>
                    </div></div>
                </div>
                <!-- Ciphers Section -->
                <div class="accordion-item">
                    <button class="accordion-button w-full text-left p-4 rounded-lg flex justify-between items-center"><span class="font-semibold text-lg text-emerald-400">Cipher & Transformasi</span><svg class="w-5 h-5 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></button>
                    <div class="accordion-content bg-gray-900/50 rounded-b-lg"><div class="p-4 space-y-4">
                        <div><label for="cipherMethod" class="block text-sm font-medium text-gray-400 mb-2">Pilih Metode:</label><select id="cipherMethod" class="input-field w-full px-3 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-400"><option value="atbash">Atbash</option><option value="albam">Albam</option><option value="atbah">Atbah</option><option value="achbi">Achbi</option><option value="avgad">Avgad</option></select></div>
                        <div id="cipherSingleResult" class="min-h-[70px]"></div>
                        <textarea id="cipherAnalysisResult" class="textarea-field w-full h-40 p-3 rounded-lg hidden" readonly placeholder="Hasil analisis AI akan muncul di sini..."></textarea>
                    </div></div>
                </div>
                <!-- Notarikon Section -->
                <div class="accordion-item">
                    <button class="accordion-button w-full text-left p-4 rounded-lg flex justify-between items-center"><span class="font-semibold text-lg text-fuchsia-400">Notarikon</span><svg class="w-5 h-5 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></button>
                    <div class="accordion-content bg-gray-900/50 rounded-b-lg"><div class="p-4 space-y-4">
                        <div id="notarikonResults" class="min-h-[70px]"></div>
                        <textarea id="notarikonAnalysisResult" class="textarea-field w-full h-40 p-3 rounded-lg hidden" readonly placeholder="Hasil analisis AI akan muncul di sini..."></textarea>
                    </div></div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // --- DATABASE & CONFIG ---
        const hebrewChars = { 'א': { val: 1, ord: 1, name: 'Aleph', milui: 111 }, 'ב': { val: 2, ord: 2, name: 'Bet', milui: 412 }, 'ג': { val: 3, ord: 3, name: 'Gimel', milui: 83 }, 'ד': { val: 4, ord: 4, name: 'Dalet', milui: 434 }, 'ה': { val: 5, ord: 5, name: 'He', milui: 15 }, 'ו': { val: 6, ord: 6, name: 'Vav', milui: 22 }, 'ז': { val: 7, ord: 7, name: 'Zayin', milui: 77 }, 'ח': { val: 8, ord: 8, name: 'Het', milui: 418 }, 'ט': { val: 9, ord: 9, name: 'Tet', milui: 419 }, 'י': { val: 10, ord: 10, name: 'Yud', milui: 20 }, 'כ': { val: 20, ord: 11, name: 'Kaf', milui: 100 }, 'ך': { val: 20, ord: 11, sofit: 500, name: 'Kaf Sofit', milui: 100 }, 'ל': { val: 30, ord: 12, name: 'Lamed', milui: 74 }, 'מ': { val: 40, ord: 13, name: 'Mem', milui: 80 }, 'ם': { val: 40, ord: 13, sofit: 600, name: 'Mem Sofit', milui: 80 }, 'ן': { val: 50, ord: 14, name: 'Nun', milui: 106 }, 'ן': { val: 50, ord: 14, sofit: 700, name: 'Nun Sofit', milui: 106 }, 'ס': { val: 60, ord: 15, name: 'Samekh', milui: 120 }, 'ע': { val: 70, ord: 16, name: 'Ayin', milui: 130 }, 'פ': { val: 80, ord: 17, name: 'Pe', milui: 81 }, 'ף': { val: 80, ord: 17, sofit: 800, name: 'Pe Sofit', milui: 81 }, 'צ': { val: 90, ord: 18, name: 'Tzadi', milui: 104 }, 'ץ': { val: 90, ord: 18, sofit: 900, name: 'Tzadi Sofit', milui: 104 }, 'ק': { val: 100, ord: 19, name: 'Kuf', milui: 186 }, 'ר': { val: 200, ord: 20, name: 'Resh', milui: 510 }, 'ש': { val: 300, ord: 21, name: 'Shin', milui: 360 }, 'ת': { val: 400, ord: 22, name: 'Tav', milui: 406 } };
        const greekChars = { 'α': 1, 'β': 2, 'γ': 3, 'δ': 4, 'ε': 5, 'ζ': 7, 'η': 8, 'θ': 9, 'ι': 10, 'κ': 20, 'λ': 30, 'μ': 40, 'ν': 50, 'ξ': 60, 'ο': 70, 'π': 80, 'ρ': 100, 'σ': 200, 'ς': 200, 'τ': 300, 'υ': 400, 'φ': 500, 'χ': 600, 'ψ': 700, 'ω': 800 };
        const theologicalDictionary = { 'elohim': { hebrew: 'אלהים', greek: 'θεος' }, 'yahweh': { hebrew: 'יהוה' }, 'yhwh': { hebrew: 'יהוה' }, 'adonai': { hebrew: 'אדני' }, 'yeshua': { hebrew: 'ישוע', greek: 'ιησους' }, 'jesus': { hebrew: 'ישוע', greek: 'ιησους' }, 'mashiach': { hebrew: 'משיח', greek: 'χριστος' }, 'messiah': { hebrew: 'משיח', greek: 'χριστος' }, 'christ': { hebrew: 'משיח', greek: 'χριστος' }, 'ruach': { hebrew: 'רוח', greek: 'πνευμα' }, 'sheol': { hebrew: 'שאול', greek: 'αδης' }, 'torah': { hebrew: 'תורה', greek: 'νομος' }, 'amen': { hebrew: 'אמן', greek: 'αμην' }, 'shalom': { hebrew: 'שלום', greek: 'ειρηνη' }, 'aletheia': { greek: 'αληθεια' }, 'logos': { greek: 'λογος' }, 'agape': { greek: 'αγαπη' }, 'pneuma': { greek: 'πνευμα' }, 'hades': { greek: 'αδης' }, };
        const translitHebrewMap = { 'tz': 'צ', 'ts': 'צ', 'ch': 'ח', 'kh': 'כ', 'sh': 'ש', 'a': 'א', 'b': 'ב', 'g': 'ג', 'd': 'ד', 'h': 'ה', 'v': 'ו', 'w': 'ו', 'u': 'ו', 'o': 'ו', 'z': 'ז', 't': 'ט', 'y': 'י', 'i': 'י', 'e': 'י', 'k': 'ק', 'l': 'ל', 'm': 'מ', 'n': 'נ', 's': 'ס', "'": 'ע', 'p': 'פ', 'f': 'פ', 'q': 'ק', 'r': 'ר', 'th': 'ת' };
        const translitGreekMap = { 'th': 'θ', 'ph': 'φ', 'ch': 'χ', 'ps': 'ψ', 'a': 'α', 'b': 'β', 'g': 'γ', 'd': 'δ', 'e': 'ε', 'z': 'ζ', 'ē': 'η', 'i': 'ι', 'k': 'κ', 'l': 'λ', 'm': 'μ', 'n': 'ν', 'x': 'ξ', 'o': 'ο', 'p': 'π', 'r': 'ρ', 's': 'σ', 't': 'τ', 'u': 'υ', 'y': 'υ', 'ō': 'ω' };

        // --- FUNGSI KALKULASI & UTILITAS ---
        function cleanInput(text) { return text.replace(/[\s.,\/#!$%\^&\*;:{}=\-_`~()0-9]/g, ""); }
        function detectLanguage(text) { for (const char of text) { if (hebrewChars[char]) return 'Ibrani'; if (greekChars[char.toLowerCase()]) return 'Yunani'; } return 'Latin'; }
        function transliterate(text, map) { let latinText = text.toLowerCase(); let resultText = ''; let i = 0; while (i < latinText.length) { let found = false; if (i + 1 < latinText.length) { let twoChar = latinText.substring(i, i + 2); if (map[twoChar]) { resultText += map[twoChar]; i += 2; found = true; } } if (!found) { let oneChar = latinText.substring(i, i + 1); if (map[oneChar]) { resultText += map[oneChar]; } i += 1; } } return resultText; }
        function calculateGematria(text) { const cleaned = cleanInput(text); let hechrechi = 0, siduri = 0, katan = 0, gadol = 0, milui = 0; for (const char of cleaned) { const data = hebrewChars[char]; if (data) { hechrechi += data.val; siduri += data.ord; katan += parseInt(data.val.toString()[0]); gadol += data.sofit || data.val; milui += data.milui; } } let katanMispari = hechrechi; while(katanMispari > 9) { katanMispari = katanMispari.toString().split('').reduce((sum, digit) => sum + parseInt(digit), 0); } return { hechrechi, siduri, katan, katanMispari, gadol, milui }; }
        function calculateIsopsephy(text) { let total = 0; const cleaned = cleanInput(text.toLowerCase()); for (const char of cleaned) { if (greekChars[char]) { total += greekChars[char]; } } return total; }
        function transformCipher(text, type) { const hebrewNormal = ['א', 'ב', 'ג', 'ד', 'ה', 'ו', 'ז', 'ח', 'ט', 'י', 'כ', 'ל', 'מ', 'נ', 'ס', 'ע', 'פ', 'צ', 'ק', 'ר', 'ש', 'ת']; const cipherMap = { atbash: {'א':'ת','ב':'ש','ג':'ר','ד':'ק','ה':'צ','ו':'פ','ז':'ע','ח':'ס','ט':'נ','י':'מ','כ':'ל','ל':'כ','מ':'י','נ':'ט','ס':'ח','ע':'ז','פ':'ו','צ':'ה','ק':'ד','ר':'ג','ש':'ב','ת':'א'}, albam: {'א':'ל','ב':'מ','ג':'נ','ד':'ס','ה':'ע','ו':'פ','ז':'צ','ח':'ק','ט':'ר','י':'ש','כ':'ת','ל':'א','מ':'ב','נ':'ג','ס':'ד','ע':'ה','פ':'ו','צ':'ז','ק':'ח','ר':'ט','ש':'י','ת':'כ'}, atbah: {'א':'ט','ב':'ח','ג':'ז','ד':'ו','ה':'ה','ו':'ד','ז':'ג','ח':'ב','ט':'א','י':'צ','כ':'פ','ל':'ע','מ':'ס','נ':'נ','ס':'מ','ע':'ל','פ':'כ','צ':'י','ק':'ת','ר':'ש','ש':'ר','ת':'ק'}, achbi: {'א':'כ','ב':'ל','ג':'מ','ד':'נ','ה':'ס','ו':'ע','ז':'פ','ח':'צ','ט':'ק','י':'ר','כ':'א','ל':'ב','מ':'ג','נ':'ד','ס':'ה','ע':'ו','פ':'ז','צ':'ח','ק':'ט','ר':'י','ש':'ת','ת':'ש'}, }; let result = ''; for (const char of text) { let transformedChar = char; if (type === 'avgad') { const index = hebrewNormal.indexOf(char); if (index !== -1) { transformedChar = hebrewNormal[(index + 1) % hebrewNormal.length]; } } else if (cipherMap[type] && cipherMap[type][char]) { transformedChar = cipherMap[type][char]; } result += transformedChar; } return result; }
        function generateNotarikon(text) { const cleaned = cleanInput(text); return cleaned.split('').map(char => { const data = hebrewChars[char]; return data ? `${char} (${data.name})` : char; }); }

        // --- RENDER HASIL ---
        function renderResult(containerId, label, value, tooltipText = '', analysisType = null, analysisData = {}) {
            const container = document.getElementById(containerId);
            container.innerHTML = ''; 
            let tooltipHtml = tooltipText ? `<div class="tooltip ml-2"><svg class="w-4 h-4 text-gray-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg><span class="tooltiptext">${tooltipText}</span></div>` : '';
            let findButtonHtml = '';
            if (analysisType) {
                const dataAttributes = Object.entries(analysisData).map(([key, val]) => `data-${key}="${val}"`).join(' ');
                findButtonHtml = `<button class="find-analysis-btn bg-amber-600 hover:bg-amber-700 text-white text-xs font-bold py-1 px-3 rounded-full transition-colors ml-4" data-type="${analysisType}" ${dataAttributes}>Analisis AI</button>`;
            }
            const resultHtml = `<div class="result-item flex justify-between items-center p-3 rounded-md"><div class="flex items-center"><span class="font-medium text-gray-300">${label}</span>${tooltipHtml}</div><div class="flex items-center"><span class="text-lg font-semibold text-amber-300 mr-2" dir="auto">${value}</span>${findButtonHtml}<button class="copy-btn p-1.5 rounded-md hover:bg-gray-600 ml-2" data-copy="${value}"><svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg></button></div></div>`;
            container.innerHTML = resultHtml;
        }
        
        // --- DYNAMIC UPDATE & WEBHOOK FUNCTIONS ---
        function updateAllCalculations(rawInput) {
            const lang = detectLanguage(rawInput);
            let hebrewInput = '', greekInput = '';
            ['detectedLang', 'transliteratedText', 'transliteratedGreekText', 'gematriaSingleResult', 'isopsephySingleResult', 'cipherSingleResult', 'notarikonResults'].forEach(id => document.getElementById(id).innerHTML = '');
            ['gematriaAnalysisResult', 'isopsephyAnalysisResult', 'cipherAnalysisResult', 'notarikonAnalysisResult'].forEach(id => {
                const textarea = document.getElementById(id);
                textarea.value = '';
                textarea.classList.add('hidden');
            });

            if (rawInput.trim() === '') return;

            if (lang === 'Ibrani') {
                document.getElementById('detectedLang').textContent = 'Input: Ibrani';
                hebrewInput = rawInput;
            } else if (lang === 'Yunani') {
                document.getElementById('detectedLang').textContent = 'Input: Yunani';
                greekInput = rawInput;
            } else { 
                const dictionaryEntry = theologicalDictionary[rawInput.toLowerCase()];
                if (dictionaryEntry) {
                    document.getElementById('detectedLang').textContent = 'Input: Latin (Kamus Teologis)';
                    hebrewInput = dictionaryEntry.hebrew || '';
                    greekInput = dictionaryEntry.greek || '';
                } else {
                    document.getElementById('detectedLang').textContent = 'Input: Latin (Transliterasi Fonetik)';
                    hebrewInput = transliterate(rawInput, translitHebrewMap);
                    greekInput = transliterate(rawInput, translitGreekMap);
                }
                document.getElementById('transliteratedText').textContent = hebrewInput;
                document.getElementById('transliteratedGreekText').textContent = greekInput;
            }
            if (hebrewInput) { updateGematriaResult(hebrewInput); updateCipherResult(hebrewInput); updateNotarikonResult(hebrewInput); }
            if (greekInput) { updateIsopsephyResult(greekInput); }
        }
        function updateGematriaResult(hebrewText) { const method = document.getElementById('gematriaMethod').value; const allValues = calculateGematria(hebrewText); const methodMap = { hechrechi: { label: 'Mispar Hechrechi', value: allValues.hechrechi, tip: 'Nilai standar/absolut.' }, siduri: { label: 'Mispar Siduri', value: allValues.siduri, tip: 'Nilai berdasarkan urutan alfabet (1-22).' }, katan: { label: 'Mispar Katan', value: allValues.katan, tip: 'Setiap huruf direduksi jadi 1 digit (nol dihilangkan).' }, katanMispari: { label: 'Mispar Katan Mispari', value: allValues.katanMispari, tip: 'Total nilai standar direduksi jadi 1 digit.' }, gadol: { label: 'Mispar Gadol', value: allValues.gadol, tip: 'Memperhitungkan nilai khusus huruf akhir (sofit).' }, milui: { label: 'Milui (Isian)', value: allValues.milui, tip: 'Nilai dari pengejaan penuh nama setiap huruf.' } }; const selected = methodMap[method]; if (selected) renderResult('gematriaSingleResult', selected.label, selected.value, selected.tip, 'gematria', { value: selected.value, method: method, methodLabel: selected.label, word: hebrewText }); }
        function updateIsopsephyResult(greekText) { const value = calculateIsopsephy(greekText); renderResult('isopsephySingleResult', 'Nilai Isopsephy', value, 'Nilai numerik standar untuk alfabet Yunani.', 'isopsephy', { value: value, word: greekText }); }
        function updateCipherResult(hebrewText) { const method = document.getElementById('cipherMethod').value; const transformedText = transformCipher(hebrewText, method); const methodMap = { atbash: { label: 'Atbash', tip: 'Huruf pertama ditukar dengan terakhir (A↔Z).' }, albam: { label: 'Albam', tip: 'Paruh pertama alfabet ditukar dengan paruh kedua (A↔L).' }, atbah: { label: 'Atbah', tip: 'Sistem substitusi spesifik (A↔T, B↔H, dst).' }, achbi: { label: 'Achbi', tip: 'Sistem substitusi spesifik lainnya (A↔K, B↔L, dst).' }, avgad: { label: 'Avgad', tip: 'Mengganti huruf dengan huruf berikutnya (A→B).' } }; const selected = methodMap[method]; if (selected) renderResult('cipherSingleResult', selected.label, transformedText, selected.tip, 'cipher', { original: hebrewText, transformed: transformedText, method: selected.label }); }
        function updateNotarikonResult(hebrewText) { const notarikon = generateNotarikon(hebrewText); renderResult('notarikonResults', 'Huruf', notarikon.join(' &rarr; '), 'Memecah kata menjadi huruf-hurufnya.', 'notarikon', { original: hebrewText, letters: hebrewText }); }

        async function findAnalysis(payload) {
            const webhookUrl = 'https://n8n.theos-automata.com/webhook/hermeneutika-analysis';
            const containerId = `${payload.type}AnalysisResult`;
            const analysisContainer = document.getElementById(containerId);
            analysisContainer.value = 'AI sedang menganalisis...';
            analysisContainer.classList.remove('hidden');

            try {
                const response = await fetch(webhookUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                
                const rawData = await response.json();
                let data;
                if (rawData.output && typeof rawData.output === 'string') {
                    data = JSON.parse(rawData.output);
                } else {
                    data = rawData;
                }

                let resultText = '';
                if (data.equivalences && data.equivalences.length > 0) {
                    resultText += 'Padanan Ditemukan:\n';
                    data.equivalences.forEach(item => {
                        resultText += `- ${item.word} (${item.meaning})\n`;
                    });
                    resultText += '\n';
                }
                if (data.analysis) {
                    resultText += 'Analisis Teologis AI:\n';
                    resultText += data.analysis;
                }
                
                analysisContainer.value = resultText.trim() !== '' ? resultText : 'Tidak ada analisis yang ditemukan.';
            } catch (error) {
                console.error('Error fetching analysis:', error);
                analysisContainer.value = `Gagal memproses jawaban AI. Periksa format output di n8n.\n\nError: ${error.message}`;
            }
        }

        // --- EVENT HANDLERS ---
        const mainInput = document.getElementById('mainInput');
        mainInput.addEventListener('input', () => updateAllCalculations(mainInput.value));
        document.getElementById('gematriaMethod').addEventListener('change', () => updateAllCalculations(mainInput.value));
        document.getElementById('cipherMethod').addEventListener('change', () => updateAllCalculations(mainInput.value));
        document.getElementById('clearButton').addEventListener('click', () => { mainInput.value = ''; updateAllCalculations(''); });
        document.querySelectorAll('.accordion-button').forEach(button => { button.addEventListener('click', () => { const content = button.nextElementSibling; const icon = button.querySelector('svg'); if (content.style.maxHeight) { content.style.maxHeight = null; icon.style.transform = 'rotate(0deg)'; } else { content.style.maxHeight = content.scrollHeight + "px"; icon.style.transform = 'rotate(180deg)'; } }); });
        document.getElementById('results').addEventListener('click', function(e) {
            const copyButton = e.target.closest('.copy-btn');
            if (copyButton) {
                const textToCopy = copyButton.dataset.copy;
                const textArea = document.createElement("textarea");
                textArea.value = textToCopy;
                document.body.appendChild(textArea);
                textArea.select();
                try { document.execCommand('copy'); const originalIcon = copyButton.innerHTML; copyButton.innerHTML = '<svg class="w-5 h-5 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>'; setTimeout(() => { copyButton.innerHTML = originalIcon; }, 1500); } catch (err) { console.error('Gagal menyalin teks: ', err); }
                document.body.removeChild(textArea);
            }
            const findButton = e.target.closest('.find-analysis-btn');
            if (findButton) {
                const payload = { type: findButton.dataset.type, ...findButton.dataset };
                findAnalysis(payload);
            }
        });
    </script>

</body>
</html>
