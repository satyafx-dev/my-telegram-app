<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator Hermeneutika</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #111827; }
        .card { background-color: #1F2937; border: 1px solid #374151; }
        .input-field, .textarea-field { background-color: #374151; border: 1px solid #4B5563; color: #F9FAFB; }
        .textarea-field::placeholder { color: #9CA3AF; }
        .result-item { background-color: #374151; border-bottom: 1px solid #4B5563; }
        .result-item:last-child { border-bottom: none; }
        .accordion-button { background-color: #374151; transition: background-color 0.2s; }
        .accordion-button:hover { background-color: #4B5563; }
        .accordion-content { max-height: 0; overflow: hidden; transition: max-height 0.3s ease-out; }
        .tooltip { position: relative; display: inline-block; cursor: help; }
        .tooltip .tooltiptext { visibility: hidden; width: 240px; background-color: #111827; color: #fff; text-align: left; border-radius: 6px; padding: 8px; position: absolute; z-index: 10; bottom: 125%; left: 50%; margin-left: -120px; opacity: 0; transition: opacity 0.3s; font-size: 0.8rem; line-height: 1.5; }
        .tooltip:hover .tooltiptext { visibility: visible; opacity: 1; }
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid #ca8a04; border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="text-gray-200 p-4 sm:p-6 md:p-8">

    <div class="max-w-3xl mx-auto">
        <header class="text-center mb-6">
            <h1 class="text-3xl sm:text-4xl font-bold text-amber-400">Kalkulator Hermeneutika</h1>
            <p class="text-gray-400 mt-2">Alat bantu untuk studi Gematria, Isopsephy, dan lainnya.</p>
        </header>

        <main class="card rounded-xl shadow-lg p-4 sm:p-6">
            <div class="flex items-center gap-2">
                <input type="text" id="mainInput" class="input-field w-full px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-400 text-lg" placeholder="Ketik (elohim, yeshua, aletheia)..." dir="auto">
                <div class="tooltip">
                    <svg class="w-6 h-6 text-gray-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg>
                    <span class="tooltiptext"><b>Panduan Penulisan:</b><br>Ketik istilah Ibrani atau Yunani dalam huruf Latin. Aplikasi akan menggunakan kamus internal untuk akurasi.<br>Contoh: <b>elohim, yahweh, aletheia</b></span>
                </div>
                <button id="clearButton" class="bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-lg transition-colors">Bersihkan</button>
            </div>
            <div id="feedbackContainer" class="text-sm text-gray-500 mt-2 h-10 flex flex-col items-start">
                <div class="flex items-center"><span id="detectedLang"></span><span id="transliteratedText" class="ml-2 text-amber-300 font-mono" dir="rtl"></span></div>
                <div class="flex items-center"><span id="transliteratedGreekText" class="ml-2 text-sky-300 font-mono"></span></div>
            </div>

            <div id="results" class="mt-6 space-y-3">
                <!-- Gematria Section -->
                <div class="accordion-item">
                    <button class="accordion-button w-full text-left p-4 rounded-lg flex justify-between items-center"><span class="font-semibold text-lg text-amber-500">Gematria (Ibrani)</span><svg class="w-5 h-5 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></button>
                    <div class="accordion-content bg-gray-900/50 rounded-b-lg"><div class="p-4 space-y-4">
                        <div><label for="gematriaMethod" class="block text-sm font-medium text-gray-400 mb-2">Pilih Metode:</label><select id="gematriaMethod" class="input-field w-full px-3 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-400"><option value="hechrechi">Mispar Hechrechi</option><option value="siduri">Mispar Siduri</option><option value="katan">Mispar Katan</option><option value="katanMispari">Mispar Katan Mispari</option><option value="gadol">Mispar Gadol</option><option value="milui">Milui (Isian)</option></select></div>
                        <div id="gematriaSingleResult" class="min-h-[70px]"></div>
                        <textarea id="gematriaAnalysisResult" class="textarea-field w-full h-40 p-3 rounded-lg hidden" readonly placeholder="Hasil analisis AI akan muncul di sini..."></textarea>
                    </div></div>
                </div>
                <!-- Isopsephy Section -->
                <div class="accordion-item">
                     <button class="accordion-button w-full text-left p-4 rounded-lg flex justify-between items-center"><span class="font-semibold text-lg text-sky-400">Isopsephy (Yunani)</span><svg class="w-5 h-5 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></button>
                    <div class="accordion-content bg-gray-900/50 rounded-b-lg"><div class="p-4 space-y-4">
                        <div id="isopsephySingleResult" class="min-h-[70px]"></div>
                        <textarea id="isopsephyAnalysisResult" class="textarea-field w-full h-40 p-3 rounded-lg hidden" readonly placeholder="Hasil analisis AI akan muncul di sini..."></textarea>
                    </div></div>
                </div>
                <!-- Ciphers Section -->
                <div class="accordion-item">
                    <button class="accordion-button w-full text-left p-4 rounded-lg flex justify-between items-center"><span class="font-semibold text-lg text-emerald-400">Cipher & Transformasi</span><svg class="w-5 h-5 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></button>
                    <div class="accordion-content bg-gray-900/50 rounded-b-lg"><div class="p-4 space-y-4">
                        <div><label for="cipherMethod" class="block text-sm font-medium text-gray-400 mb-2">Pilih Metode:</label><select id="cipherMethod" class="input-field w-full px-3 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-400"><option value="atbash">Atbash</option><option value="albam">Albam</option><option value="atbah">Atbah</option><option value="achbi">Achbi</option><option value="avgad">Avgad</option></select></div>
                        <div id="cipherSingleResult" class="min-h-[70px]"></div>
                        <textarea id="cipherAnalysisResult" class="textarea-field w-full h-40 p-3 rounded-lg hidden" readonly placeholder="Hasil analisis AI akan muncul di sini..."></textarea>
                    </div></div>
                </div>
                <!-- Notarikon Section -->
                <div class="accordion-item">
                    <button class="accordion-button w-full text-left p-4 rounded-lg flex justify-between items-center"><span class="font-semibold text-lg text-fuchsia-400">Notarikon</span><svg class="w-5 h-5 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></button>
                    <div class="accordion-content bg-gray-900/50 rounded-b-lg"><div class="p-4 space-y-4">
                        <div id="notarikonResults" class="min-h-[70px]"></div>
                        <textarea id="notarikonAnalysisResult" class="textarea-field w-full h-40 p-3 rounded-lg hidden" readonly placeholder="Hasil analisis AI akan muncul di sini..."></textarea>
                    </div></div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // --- DATABASE & CONFIG ---
        const hebrewChars = { '×': { val: 1, ord: 1, name: 'Aleph', milui: 111 }, '×‘': { val: 2, ord: 2, name: 'Bet', milui: 412 }, '×’': { val: 3, ord: 3, name: 'Gimel', milui: 83 }, '×“': { val: 4, ord: 4, name: 'Dalet', milui: 434 }, '×”': { val: 5, ord: 5, name: 'He', milui: 15 }, '×•': { val: 6, ord: 6, name: 'Vav', milui: 22 }, '×–': { val: 7, ord: 7, name: 'Zayin', milui: 77 }, '×—': { val: 8, ord: 8, name: 'Het', milui: 418 }, '×˜': { val: 9, ord: 9, name: 'Tet', milui: 419 }, '×™': { val: 10, ord: 10, name: 'Yud', milui: 20 }, '×›': { val: 20, ord: 11, name: 'Kaf', milui: 100 }, '×š': { val: 20, ord: 11, sofit: 500, name: 'Kaf Sofit', milui: 100 }, '×œ': { val: 30, ord: 12, name: 'Lamed', milui: 74 }, '×': { val: 40, ord: 13, name: 'Mem', milui: 80 }, '×': { val: 40, ord: 13, sofit: 600, name: 'Mem Sofit', milui: 80 }, '× ': { val: 50, ord: 14, name: 'Nun', milui: 106 }, '×Ÿ': { val: 50, ord: 14, sofit: 700, name: 'Nun Sofit', milui: 106 }, '×¡': { val: 60, ord: 15, name: 'Samekh', milui: 120 }, '×¢': { val: 70, ord: 16, name: 'Ayin', milui: 130 }, '×¤': { val: 80, ord: 17, name: 'Pe', milui: 81 }, '×£': { val: 80, ord: 17, sofit: 800, name: 'Pe Sofit', milui: 81 }, '×¦': { val: 90, ord: 18, name: 'Tzadi', milui: 104 }, '×¥': { val: 90, ord: 18, sofit: 900, name: 'Tzadi Sofit', milui: 104 }, '×§': { val: 100, ord: 19, name: 'Kuf', milui: 186 }, '×¨': { val: 200, ord: 20, name: 'Resh', milui: 510 }, '×©': { val: 300, ord: 21, name: 'Shin', milui: 360 }, '×ª': { val: 400, ord: 22, name: 'Tav', milui: 406 } };
        const greekChars = { 'Î±': 1, 'Î²': 2, 'Î³': 3, 'Î´': 4, 'Îµ': 5, 'Î¶': 7, 'Î·': 8, 'Î¸': 9, 'Î¹': 10, 'Îº': 20, 'Î»': 30, 'Î¼': 40, 'Î½': 50, 'Î¾': 60, 'Î¿': 70, 'Ï€': 80, 'Ï': 100, 'Ïƒ': 200, 'Ï‚': 200, 'Ï„': 300, 'Ï…': 400, 'Ï†': 500, 'Ï‡': 600, 'Ïˆ': 700, 'Ï‰': 800 };
        const theologicalDictionary = { 'elohim': { hebrew: '××œ×”×™×', greek: 'Î¸ÎµÎ¿Ï‚' }, 'yahweh': { hebrew: '×™×”×•×”' }, 'yhwh': { hebrew: '×™×”×•×”' }, 'adonai': { hebrew: '××“× ×™' }, 'yeshua': { hebrew: '×™×©×•×¢', greek: 'Î¹Î·ÏƒÎ¿Ï…Ï‚' }, 'jesus': { hebrew: '×™×©×•×¢', greek: 'Î¹Î·ÏƒÎ¿Ï…Ï‚' }, 'mashiach': { hebrew: '××©×™×—', greek: 'Ï‡ÏÎ¹ÏƒÏ„Î¿Ï‚' }, 'messiah': { hebrew: '××©×™×—', greek: 'Ï‡ÏÎ¹ÏƒÏ„Î¿Ï‚' }, 'christ': { hebrew: '××©×™×—', greek: 'Ï‡ÏÎ¹ÏƒÏ„Î¿Ï‚' }, 'ruach': { hebrew: '×¨×•×—', greek: 'Ï€Î½ÎµÏ…Î¼Î±' }, 'sheol': { hebrew: '×©××•×œ', greek: 'Î±Î´Î·Ï‚' }, 'torah': { hebrew: '×ª×•×¨×”', greek: 'Î½Î¿Î¼Î¿Ï‚' }, 'amen': { hebrew: '×××Ÿ', greek: 'Î±Î¼Î·Î½' }, 'shalom': { hebrew: '×©×œ×•×', greek: 'ÎµÎ¹ÏÎ·Î½Î·' }, 'aletheia': { greek: 'Î±Î»Î·Î¸ÎµÎ¹Î±' }, 'logos': { greek: 'Î»Î¿Î³Î¿Ï‚' }, 'agape': { greek: 'Î±Î³Î±Ï€Î·' }, 'pneuma': { greek: 'Ï€Î½ÎµÏ…Î¼Î±' }, 'hades': { greek: 'Î±Î´Î·Ï‚' }, };
        const translitHebrewMap = { 'tz': '×¦', 'ts': '×¦', 'ch': '×—', 'kh': '×›', 'sh': '×©', 'a': '×', 'b': '×‘', 'g': '×’', 'd': '×“', 'h': '×”', 'v': '×•', 'w': '×•', 'u': '×•', 'o': '×•', 'z': '×–', 't': '×˜', 'y': '×™', 'i': '×™', 'e': '×™', 'k': '×§', 'l': '×œ', 'm': '×', 'n': '× ', 's': '×¡', "'": '×¢', 'p': '×¤', 'f': '×¤', 'q': '×§', 'r': '×¨', 'th': '×ª' };
        const translitGreekMap = { 'th': 'Î¸', 'ph': 'Ï†', 'ch': 'Ï‡', 'ps': 'Ïˆ', 'a': 'Î±', 'b': 'Î²', 'g': 'Î³', 'd': 'Î´', 'e': 'Îµ', 'z': 'Î¶', 'Ä“': 'Î·', 'i': 'Î¹', 'k': 'Îº', 'l': 'Î»', 'm': 'Î¼', 'n': 'Î½', 'x': 'Î¾', 'o': 'Î¿', 'p': 'Ï€', 'r': 'Ï', 's': 'Ïƒ', 't': 'Ï„', 'u': 'Ï…', 'y': 'Ï…', 'Å': 'Ï‰' };

        // --- FUNGSI KALKULASI & UTILITAS ---
        function cleanInput(text) { return text.replace(/[\s.,\/#!$%\^&\*;:{}=\-_`~()0-9]/g, ""); }
        function detectLanguage(text) { for (const char of text) { if (hebrewChars[char]) return 'Ibrani'; if (greekChars[char.toLowerCase()]) return 'Yunani'; } return 'Latin'; }
        function transliterate(text, map) { let latinText = text.toLowerCase(); let resultText = ''; let i = 0; while (i < latinText.length) { let found = false; if (i + 1 < latinText.length) { let twoChar = latinText.substring(i, i + 2); if (map[twoChar]) { resultText += map[twoChar]; i += 2; found = true; } } if (!found) { let oneChar = latinText.substring(i, i + 1); if (map[oneChar]) { resultText += map[oneChar]; } i += 1; } } return resultText; }
        function calculateGematria(text) { const cleaned = cleanInput(text); let hechrechi = 0, siduri = 0, katan = 0, gadol = 0, milui = 0; for (const char of cleaned) { const data = hebrewChars[char]; if (data) { hechrechi += data.val; siduri += data.ord; katan += parseInt(data.val.toString()[0]); gadol += data.sofit || data.val; milui += data.milui; } } let katanMispari = hechrechi; while(katanMispari > 9) { katanMispari = katanMispari.toString().split('').reduce((sum, digit) => sum + parseInt(digit), 0); } return { hechrechi, siduri, katan, katanMispari, gadol, milui }; }
        function calculateIsopsephy(text) { let total = 0; const cleaned = cleanInput(text.toLowerCase()); for (const char of cleaned) { if (greekChars[char]) { total += greekChars[char]; } } return total; }
        function transformCipher(text, type) { const hebrewNormal = ['×', '×‘', '×’', '×“', '×”', '×•', '×–', '×—', '×˜', '×™', '×›', '×œ', '×', '× ', '×¡', '×¢', '×¤', '×¦', '×§', '×¨', '×©', '×ª']; const cipherMap = { atbash: {'×':'×ª','×‘':'×©','×’':'×¨','×“':'×§','×”':'×¦','×•':'×¤','×–':'×¢','×—':'×¡','×˜':'× ','×™':'×','×›':'×œ','×œ':'×›','×':'×™','× ':'×˜','×¡':'×—','×¢':'×–','×¤':'×•','×¦':'×”','×§':'×“','×¨':'×’','×©':'×‘','×ª':'×'}, albam: {'×':'×œ','×‘':'×','×’':'× ','×“':'×¡','×”':'×¢','×•':'×¤','×–':'×¦','×—':'×§','×˜':'×¨','×™':'×©','×›':'×ª','×œ':'×','×':'×‘','× ':'×’','×¡':'×“','×¢':'×”','×¤':'×•','×¦':'×–','×§':'×—','×¨':'×˜','×©':'×™','×ª':'×›'}, atbah: {'×':'×˜','×‘':'×—','×’':'×–','×“':'×•','×”':'×”','×•':'×“','×–':'×’','×—':'×‘','×˜':'×','×™':'×¦','×›':'×¤','×œ':'×¢','×':'×¡','× ':'× ','×¡':'×','×¢':'×œ','×¤':'×›','×¦':'×™','×§':'×ª','×¨':'×©','×©':'×¨','×ª':'×§'}, achbi: {'×':'×›','×‘':'×œ','×’':'×','×“':'× ','×”':'×¡','×•':'×¢','×–':'×¤','×—':'×¦','×˜':'×§','×™':'×¨','×›':'×','×œ':'×‘','×':'×’','× ':'×“','×¡':'×”','×¢':'×•','×¤':'×–','×¦':'×—','×§':'×˜','×¨':'×™','×©':'×ª','×ª':'×©'}, }; let result = ''; for (const char of text) { let transformedChar = char; if (type === 'avgad') { const index = hebrewNormal.indexOf(char); if (index !== -1) { transformedChar = hebrewNormal[(index + 1) % hebrewNormal.length]; } } else if (cipherMap[type] && cipherMap[type][char]) { transformedChar = cipherMap[type][char]; } result += transformedChar; } return result; }
        function generateNotarikon(text) { const cleaned = cleanInput(text); return cleaned.split('').map(char => { const data = hebrewChars[char]; return data ? `${char} (${data.name})` : char; }); }

        // --- RENDER HASIL ---
        function renderResult(containerId, label, value, tooltipText = '', analysisType = null, analysisData = {}) {
            const container = document.getElementById(containerId);
            container.innerHTML = ''; 
            let tooltipHtml = tooltipText ? `<div class="tooltip ml-2"><svg class="w-4 h-4 text-gray-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg><span class="tooltiptext">${tooltipText}</span></div>` : '';
            let findButtonHtml = '';
            if (analysisType) {
                const dataAttributes = Object.entries(analysisData).map(([key, val]) => `data-${key}="${val}"`).join(' ');
                findButtonHtml = `<button class="find-analysis-btn bg-amber-600 hover:bg-amber-700 text-white text-xs font-bold py-1 px-3 rounded-full transition-colors ml-4" data-type="${analysisType}" ${dataAttributes}>Analisis AI</button>`;
            }
            const resultHtml = `<div class="result-item flex justify-between items-center p-3 rounded-md"><div class="flex items-center"><span class="font-medium text-gray-300">${label}</span>${tooltipHtml}</div><div class="flex items-center"><span class="text-lg font-semibold text-amber-300 mr-2" dir="auto">${value}</span>${findButtonHtml}<button class="copy-btn p-1.5 rounded-md hover:bg-gray-600 ml-2" data-copy="${value}"><svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg></button></div></div>`;
            container.innerHTML = resultHtml;
        }
        
        // --- DYNAMIC UPDATE & WEBHOOK FUNCTIONS ---
        function updateAllCalculations(rawInput) {
            const lang = detectLanguage(rawInput);
            let hebrewInput = '', greekInput = '';
            ['detectedLang', 'transliteratedText', 'transliteratedGreekText', 'gematriaSingleResult', 'isopsephySingleResult', 'cipherSingleResult', 'notarikonResults'].forEach(id => document.getElementById(id).innerHTML = '');
            ['gematriaAnalysisResult', 'isopsephyAnalysisResult', 'cipherAnalysisResult', 'notarikonAnalysisResult'].forEach(id => {
                const textarea = document.getElementById(id);
                textarea.value = '';
                textarea.classList.add('hidden');
            });

            if (rawInput.trim() === '') return;

            if (lang === 'Ibrani') {
                document.getElementById('detectedLang').textContent = 'Input: Ibrani';
                hebrewInput = rawInput;
            } else if (lang === 'Yunani') {
                document.getElementById('detectedLang').textContent = 'Input: Yunani';
                greekInput = rawInput;
            } else { 
                const dictionaryEntry = theologicalDictionary[rawInput.toLowerCase()];
                if (dictionaryEntry) {
                    document.getElementById('detectedLang').textContent = 'Input: Latin (Kamus Teologis)';
                    hebrewInput = dictionaryEntry.hebrew || '';
                    greekInput = dictionaryEntry.greek || '';
                } else {
                    document.getElementById('detectedLang').textContent = 'Input: Latin (Transliterasi Fonetik)';
                    hebrewInput = transliterate(rawInput, translitHebrewMap);
                    greekInput = transliterate(rawInput, translitGreekMap);
                }
                document.getElementById('transliteratedText').textContent = hebrewInput;
                document.getElementById('transliteratedGreekText').textContent = greekInput;
            }
            if (hebrewInput) { updateGematriaResult(hebrewInput); updateCipherResult(hebrewInput); updateNotarikonResult(hebrewInput); }
            if (greekInput) { updateIsopsephyResult(greekInput); }
        }
        function updateGematriaResult(hebrewText) { const method = document.getElementById('gematriaMethod').value; const allValues = calculateGematria(hebrewText); const methodMap = { hechrechi: { label: 'Mispar Hechrechi', value: allValues.hechrechi, tip: 'Nilai standar/absolut.' }, siduri: { label: 'Mispar Siduri', value: allValues.siduri, tip: 'Nilai berdasarkan urutan alfabet (1-22).' }, katan: { label: 'Mispar Katan', value: allValues.katan, tip: 'Setiap huruf direduksi jadi 1 digit (nol dihilangkan).' }, katanMispari: { label: 'Mispar Katan Mispari', value: allValues.katanMispari, tip: 'Total nilai standar direduksi jadi 1 digit.' }, gadol: { label: 'Mispar Gadol', value: allValues.gadol, tip: 'Memperhitungkan nilai khusus huruf akhir (sofit).' }, milui: { label: 'Milui (Isian)', value: allValues.milui, tip: 'Nilai dari pengejaan penuh nama setiap huruf.' } }; const selected = methodMap[method]; if (selected) renderResult('gematriaSingleResult', selected.label, selected.value, selected.tip, 'gematria', { value: selected.value, word: hebrewText, language: 'Ibrani' }); }
        function updateIsopsephyResult(greekText) { const value = calculateIsopsephy(greekText); renderResult('isopsephySingleResult', 'Nilai Isopsephy', value, 'Nilai numerik standar untuk alfabet Yunani.', 'isopsephy', { value: value, word: greekText }); }
        function updateCipherResult(hebrewText) { const method = document.getElementById('cipherMethod').value; const transformedText = transformCipher(hebrewText, method); const methodMap = { atbash: { label: 'Atbash', tip: 'Huruf pertama ditukar dengan terakhir (Aâ†”Z).' }, albam: { label: 'Albam', tip: 'Paruh pertama alfabet ditukar dengan paruh kedua (Aâ†”L).' }, atbah: { label: 'Atbah', tip: 'Sistem substitusi spesifik (Aâ†”T, Bâ†”H, dst).' }, achbi: { label: 'Achbi', tip: 'Sistem substitusi spesifik lainnya (Aâ†”K, Bâ†”L, dst).' }, avgad: { label: 'Avgad', tip: 'Mengganti huruf dengan huruf berikutnya (Aâ†’B).' } }; const selected = methodMap[method]; if (selected) renderResult('cipherSingleResult', selected.label, transformedText, selected.tip, 'cipher', { original: hebrewText, transformed: transformedText, method: selected.label }); }
        function updateNotarikonResult(hebrewText) { const notarikon = generateNotarikon(hebrewText); renderResult('notarikonResults', 'Huruf', notarikon.join(' â†’ '), 'Memecah kata menjadi huruf-hurufnya.', 'notarikon', { original: hebrewText, letters: hebrewText }); }

        async function findAnalysis(payload) {
            const webhookUrl = 'https://n8n.theos-automata.com/webhook/hermeneutika-analysis';
            const containerId = `${payload.type}AnalysisResult`;
            const analysisContainer = document.getElementById(containerId);
            analysisContainer.value = 'AI sedang menganalisis...';
            analysisContainer.classList.remove('hidden');

            try {
                const response = await fetch(webhookUrl, { 
                    method: 'POST', 
                    headers: { 'Content-Type': 'application/json' }, 
                    body: JSON.stringify(payload) 
                });
                
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                
                // Langsung parse JSON response dari n8n
                const data = await response.json();

                let resultText = '';
                
                // Check if data is array (n8n returns array of items)
                const item = Array.isArray(data) ? data[0] : data;
                
                if (item.equivalences && item.equivalences.length > 0) {
                    resultText += 'ğŸ“š Padanan Ditemukan:\n\n';
                    item.equivalences.forEach((entry, index) => {
                        resultText += `${index + 1}. ${entry.word}\n`;
                        resultText += `   ğŸ“– ${entry.transliteration || ''}\n`;
                        resultText += `   ğŸ’¡ ${entry.meaning}\n`;
                        if (entry.reference) {
                            resultText += `   ğŸ“œ ${entry.reference}\n`;
                        }
                        resultText += '\n';
                    });
                }
                
                if (item.analysis) {
                    resultText += 'ğŸ” Analisis Teologis:\n\n';
                    resultText += item.analysis;
                }
                
                analysisContainer.value = resultText.trim() !== '' ? resultText : 'Tidak ada analisis yang ditemukan.';
            } catch (error) {
                console.error('Error fetching analysis:', error);
                analysisContainer.value = `âŒ Gagal memuat analisis AI.\n\nError: ${error.message}\n\nSilakan coba lagi atau periksa koneksi internet Anda.`;
            }
        }

        // --- EVENT HANDLERS ---
        const mainInput = document.getElementById('mainInput');
        mainInput.addEventListener('input', () => updateAllCalculations(mainInput.value));
        document.getElementById('gematriaMethod').addEventListener('change', () => updateAllCalculations(mainInput.value));
        document.getElementById('cipherMethod').addEventListener('change', () => updateAllCalculations(mainInput.value));
        document.getElementById('clearButton').addEventListener('click', () => { mainInput.value = ''; updateAllCalculations(''); });
        document.querySelectorAll('.accordion-button').forEach(button => { button.addEventListener('click', () => { const content = button.nextElementSibling; const icon = button.querySelector('svg'); if (content.style.maxHeight) { content.style.maxHeight = null; icon.style.transform = 'rotate(0deg)'; } else { content.style.maxHeight = content.scrollHeight + "px"; icon.style.transform = 'rotate(180deg)'; } }); });
        document.getElementById('results').addEventListener('click', function(e) {
            const copyButton = e.target.closest('.copy-btn');
            if (copyButton) {
                const textToCopy = copyButton.dataset.copy;
                const textArea = document.createElement("textarea");
                textArea.value = textToCopy;
                document.body.appendChild(textArea);
                textArea.select();
                try { document.execCommand('copy'); const originalIcon = copyButton.innerHTML; copyButton.innerHTML = '<svg class="w-5 h-5 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>'; setTimeout(() => { copyButton.innerHTML = originalIcon; }, 1500); } catch (err) { console.error('Gagal menyalin teks: ', err); }
                document.body.removeChild(textArea);
            }
            const findButton = e.target.closest('.find-analysis-btn');
            if (findButton) {
                const payload = { type: findButton.dataset.type, ...findButton.dataset };
                findAnalysis(payload);
            }
        });
    </script>

</body>
</html>
